<!DOCTYPE html>
<html lang="en">
<head>
     <!-- Early theme application (prevents flash) -->
    <script>
        if (localStorage.getItem("theme") === "dark") {
            document.documentElement.classList.add("dark");
        }
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>{{ title }} â€¢ {{ site.title }}</title>

    <link rel="stylesheet" href="{{ '/styles/style.css' | url }}">
    <link rel="icon" type="image/png" href="{{ '/assets/images/favicon.png' | url }}">
    <link rel="apple-touch-icon" href="{{ '/assets/images/favicon.png' | url }}">
</head>
<body>
    <header class="site-header">
        <div class="container">
            <div class="site-title">
                <a href="{{ '/' | url }}">{{ site.displayTitle }}</a>
            </div>

            <nav class="site-nav">
                <!-- Mobile Menu Toggle -->
                <button id="mobile-menu-toggle" class="mobile-menu-toggle hide-desktop" aria-label="Toggle menu" aria-expanded="false">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>

                <!-- Main Navigation -->
                <div class="nav-menu">
                    <ul>
                        {% for item in collections.all | eleventyNavigation %}
                        <li class="
                            nav-item
                            {% if page.url == item.url %}active{% endif %} 
                            {% if item.children and item.children | length > 0 %}has-children{% endif %}
                        ">
                            <a href="{{ item.url | url }}">
                                {{ item.title }}
                                {% if item.children and item.children | length > 0 %}
                                    <span class="submenu-toggle" aria-label="Toggle submenu">â†“</span>
                                {% endif %}
                            </a>

                            {% if item.children and item.children | length > 0 %}
                                <ul class="sub-nav">
                                    {% for child in item.children %}
                                    <li class="{% if page.url == child.url %}active{% endif %}">
                                        <a href="{{ child.url | url }}">{{ child.title }}</a>
                                    </li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                </div>

                <!-- Theme Toggle -->
                <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode">
                    <svg id="theme-icon" viewBox="0 0 24 24" width="24" height="24" aria-hidden="true">
                        <path id="theme-icon-path"
                              fill="currentColor"
                              d="M12 4a8 8 0 1 0 0 16 8 8 0 0 1 0-16z">
                        </path>
                        <g id="sun-rays"
                           fill="none"
                           stroke="currentColor"
                           stroke-width="2"
                           stroke-linecap="round">
                            <line x1="12" y1="1" x2="12" y2="4"/>
                            <line x1="12" y1="20" x2="12" y2="23"/>
                            <line x1="4.2" y1="4.2" x2="6.3" y2="6.3"/>
                            <line x1="17.7" y1="17.7" x2="19.8" y2="19.8"/>
                            <line x1="1" y1="12" x2="4" y2="12"/>
                            <line x1="20" y1="12" x2="23" y2="12"/>
                            <line x1="4.2" y1="19.8" x2="6.3" y2="17.7"/>
                            <line x1="17.7" y1="6.3" x2="19.8" y2="4.2"/>
                        </g>
                    </svg>
                </button>
            </nav>
        </div>
    </header>

    <main class="content">
        {% if not hidePageTitle %}
            <h1 class="page-title">{{ title }}</h1>
        {% endif %}
        {{ content | safe }}
    </main>

    <footer>
        <p>&copy; {{ "" | year }} 
            <a href="{{ '/about/' | url }}">Sasha Smith</a> Â· 
            <a href="{{ '/contact/' | url }}">Say Hi</a> ðŸ‘‹
        </p>
    </footer>

    <!-- JS -->
    <script>
        /* ---------- Theme Toggle ---------- */
        const themeToggle = document.getElementById("theme-toggle");
        const themeIconPath = document.getElementById("theme-icon-path");

        const ICONS = {
            sun:  "M12 4a8 8 0 1 0 0 16 8 8 0 0 1 0-16z",
            moon: "M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"
        };

        // Set initial icon
        const isDark = document.documentElement.classList.contains("dark");
        themeIconPath.setAttribute("d", isDark ? ICONS.moon : ICONS.sun);

        themeToggle.addEventListener("click", () => {
            const nowDark = document.documentElement.classList.toggle("dark");
            localStorage.setItem("theme", nowDark ? "dark" : "light");
            themeIconPath.setAttribute("d", nowDark ? ICONS.moon : ICONS.sun);
        });

         /* ---------- Accordion ---------- */
        document.querySelectorAll(".accordion-toggle").forEach(button => {
            button.addEventListener("click", () => {
                const item = button.parentElement;
                const expanded = button.getAttribute("aria-expanded") === "true";

                item.classList.toggle("active");
                button.setAttribute("aria-expanded", !expanded);
            });
        });

        /* ---------- Mobile Menu ---------- */
        const mobileToggle = document.querySelector(".mobile-menu-toggle");
        const navMenu = document.querySelector(".site-nav ul");

        // Hamburger opens/closes the whole menu
        mobileToggle.addEventListener("click", () => {
            const expanded = mobileToggle.classList.toggle("open");
            navMenu.classList.toggle("open");
            mobileToggle.setAttribute("aria-expanded", expanded);
        });

        // Submenu toggles for mobile
        document.querySelectorAll(".submenu-toggle").forEach(toggle => {
            toggle.addEventListener("click", (e) => {
                e.preventDefault(); // prevent arrow click from following link

                const parentLi = toggle.closest("li.has-children");
                const subNav = parentLi.querySelector(".sub-nav");

                // Toggle classes
                subNav.classList.toggle("open");       // show/hide submenu
                parentLi.classList.toggle("active");   // rotate arrow
            });
        });

    </script>
</body>
</html>